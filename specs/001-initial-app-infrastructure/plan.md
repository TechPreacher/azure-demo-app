# Implementation Plan: Initial App Infrastructure

**Branch**: `001-initial-app-infrastructure` | **Date**: 2026-01-08 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/001-initial-app-infrastructure/spec.md`

## Summary

Build an Azure Service Catalog CRUD application with a Streamlit frontend, FastAPI backend, and Azure Blob Storage persistence. Deploy infrastructure using Terraform. The application manages Azure service definitions (service name, category, description) with full local development support.

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**:
- Backend: FastAPI, Pydantic, azure-storage-blob, uvicorn, opencensus-ext-azure
- Frontend: Streamlit, httpx, opencensus-ext-azure
**Storage**: Azure Blob Storage (services.json) with local file fallback for development
**Testing**: pytest, pytest-cov, pytest-asyncio, httpx (test client)
**Target Platform**: Azure App Service (Linux containers)
**Project Type**: Web application (frontend + backend + infrastructure)
**Performance Goals**: 
- Page load < 3 seconds
- CRUD operations < 2 seconds
- Support 100 concurrent users
**Constraints**: 
- No authentication required (demo app)
- Single-region deployment
- JSON file storage (< 10MB data)
**Scale/Scope**: ~130 Azure services in catalog, single deployment environment

## Constitution Check

*GATE: Must pass before implementation.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Start Simple | ✅ | Single JSON file storage, no DB |
| II. Limit Scope | ✅ | 2 services + infra, no auth |
| III. Avoid Over-Engineering | ✅ | Direct storage access, no repository pattern |
| IV. Code Quality | ✅ | Type hints, Pydantic validation, structured logs |
| V. Clear Documentation | ✅ | README with local dev setup, API docs via OpenAPI |
| VI. Testing | ✅ | Unit + integration + contract tests, 80% coverage |

## Project Structure

### Documentation (this feature)

```text
specs/001-initial-app-infrastructure/
├── plan.md              # This file
├── spec.md              # Feature specification
└── tasks.md             # Task breakdown (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── __init__.py
│   ├── main.py              # FastAPI app entry point
│   ├── config.py            # Settings and environment config
│   ├── models/
│   │   ├── __init__.py
│   │   └── service.py       # Service Pydantic models
│   ├── services/
│   │   ├── __init__.py
│   │   └── storage.py       # Storage adapter (Azure Blob + local fallback)
│   └── api/
│       ├── __init__.py
│       ├── routes.py        # API route definitions
│       └── dependencies.py  # FastAPI dependencies
├── tests/
│   ├── __init__.py
│   ├── conftest.py          # Pytest fixtures
│   ├── unit/
│   │   ├── __init__.py
│   │   └── test_storage.py  # Storage service unit tests
│   ├── integration/
│   │   ├── __init__.py
│   │   └── test_api.py      # API endpoint integration tests
│   └── contract/
│       ├── __init__.py
│       └── test_openapi.py  # Contract validation tests
└── pyproject.toml           # Backend dependencies (uv)

frontend/
├── src/
│   ├── __init__.py
│   ├── app.py               # Streamlit main application
│   ├── config.py            # Frontend configuration
│   ├── api_client.py        # Backend API client
│   └── components/
│       ├── __init__.py
│       ├── service_list.py  # Service listing component
│       ├── service_form.py  # Create/edit form component
│       └── filters.py       # Search/filter component
├── tests/
│   ├── __init__.py
│   ├── conftest.py
│   └── test_api_client.py   # API client tests
└── pyproject.toml           # Frontend dependencies (uv)

infrastructure/
├── main.tf                  # Main Terraform configuration
├── variables.tf             # Input variables
├── outputs.tf               # Output values
├── providers.tf             # Provider configuration
└── modules/
    ├── resource_group/
    │   └── main.tf
    ├── storage/
    │   └── main.tf
    ├── app_service/
    │   └── main.tf
    └── monitoring/
        └── main.tf

data/
└── services.json            # Default Azure services data (seed data)

scripts/
├── dev.sh                   # Local development startup script
└── test.sh                  # Run all tests script

README.md                    # Project documentation with setup instructions
```

**Structure Decision**: Web application pattern with separate backend/frontend services, shared infrastructure module. Local development uses file-based storage adapter to avoid Azure dependencies.

## Key Design Decisions

### Storage Adapter Pattern

The backend uses a storage adapter interface with two implementations:
1. **AzureBlobStorageAdapter**: Production - reads/writes to Azure Blob Storage
2. **LocalFileStorageAdapter**: Development - reads/writes to local `data/services.json`

Selection is based on environment variable `STORAGE_TYPE` (default: `local`).

### API Design

RESTful endpoints under `/api/v1/services`:
- `GET /api/v1/services` - List all services (with optional query params for filtering)
- `GET /api/v1/services/{service_name}` - Get single service by name
- `POST /api/v1/services` - Create new service
- `PUT /api/v1/services/{service_name}` - Update existing service
- `DELETE /api/v1/services/{service_name}` - Delete service
- `GET /health` - Health check endpoint

### Local Development

```bash
# Terminal 1: Backend
cd backend && uv run uvicorn src.main:app --reload --port 8000

# Terminal 2: Frontend
cd frontend && uv run streamlit run src/app.py --server.port 8501
```

Or use the convenience script: `./scripts/dev.sh`

## Complexity Tracking

No constitution violations identified. The design follows all six principles with appropriate simplicity for a demo application.
